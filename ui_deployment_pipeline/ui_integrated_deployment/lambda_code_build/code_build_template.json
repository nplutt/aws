{
    "AWSTemplateFormatVersion": "2010-09-09",
    "Description": "This CloudFormation template creates a build for an angular2 build.",
    "Resources": {
        "S3UnzipCodeBuildPolicy": {
            "Properties": {
                "PolicyDocument": {
                    "Statement": [
                        {
                            "Action": [
                                "logs:CreateLogGroup",
                                "logs:CreateLogStream",
                                "logs:PutLogEvents"
                            ],
                            "Effect": "Allow",
                            "Resource": [
                                "arn:aws:logs:us-west-2:562628674386:log-group:/aws/codebuild/lambdas3unzip",
                                "arn:aws:logs:us-west-2:562628674386:log-group:/aws/codebuild/lambdas3unzip:*"
                            ]
                        },
                        {
                            "Action": [
                                "s3:*"
                            ],
                            "Effect": "Allow",
                            "Resource": [
                                "arn:aws:s3:::*"
                            ]
                        },
                        {
                            "Action": [
                                "iam:PassRole",
                                "iam:CreateRole",
                                "iam:PutRolePolicy",
                                "iam:ListRolePolicies",
                                "iam:DeleteRolePolicy",
                                "iam:DeleteRole",
                                "iam:GetRole"
                            ],
                            "Effect": "Allow",
                            "Resource": [
                                "arn:aws:iam::562628674386:role/*"
                            ]
                        },
                        {
                            "Action": [
                                "lambda:CreateFunction",
                                "Lambda:UpdateAlias",
                                "Lambda:CreateAlias",
                                "Lambda:GetFunctionConfiguration",
                                "Lambda:AddPermission",
                                "Lambda:DeleteFunction"
                            ],
                            "Effect": "Allow",
                            "Resource": [
                                "arn:aws:lambda:us-west-2:562628674386:function:s3-unzip"
                            ]
                        }
                    ],
                    "Version": "2012-10-17"
                },
                "Roles": [
                    {
                        "Ref": "S3UnzipCodeBuildRole"
                    }
                ]
            },
            "Type": "AWS::IAM::ManagedPolicy"
        },
        "S3UnzipCodeBuildProfile": {
            "Properties": {
                "Path": "/service-role/",
                "Roles": [
                    {
                        "Ref": "S3UnzipCodeBuildRole"
                    }
                ]
            },
            "Type": "AWS::IAM::InstanceProfile"
        },
        "S3UnzipCodeBuildRole": {
            "Properties": {
                "AssumeRolePolicyDocument": {
                    "Statement": [
                        {
                            "Action": [
                                "sts:AssumeRole"
                            ],
                            "Effect": "Allow",
                            "Principal": {
                                "Service": [
                                    "codebuild.amazonaws.com",
                                    "s3.amazonaws.com"
                                ]
                            }
                        }
                    ]
                }
            },
            "Type": "AWS::IAM::Role"
        },
        "lambdas3unzip": {
            "Properties": {
                "Artifacts": {
                    "Location": "npluttcode1",
                    "Name": "lambdas3unzip",
                    "Type": "S3"
                },
                "Environment": {
                    "ComputeType": "BUILD_GENERAL1_SMALL",
                    "EnvironmentVariables": [
                        {
                            "Name": "REGION",
                            "Value": "us-west-2"
                        },
                        {
                            "Name": "TIMEOUT",
                            "Value": "60"
                        },
                        {
                            "Name": "BUCKET",
                            "Value": "npluttcode1"
                        },
                        {
                            "Name": "PREFIX",
                            "Value": "ui/MyAppBuild/"
                        },
                        {
                            "Name": "WEB_BUCKET",
                            "Value": "npluttwebsite1"
                        },
                        {
                            "Name": "LAMBDA_ROLE",
                            "Value": "S3UnzipRole"
                        }
                    ],
                    "Image": "nplutt/front-end-build-server:latest",
                    "Type": "LINUX_CONTAINER"
                },
                "Name": "lambdas3unzip",
                "ServiceRole": {
                    "Ref": "S3UnzipCodeBuildRole"
                },
                "Source": {
                    "Location": "https://github.com/nplutt/lambda-s3-unzip",
                    "Type": "GITHUB"
                },
                "TimeoutInMinutes": 5
            },
            "Type": "AWS::CodeBuild::Project"
        }
    }
}