{
    "AWSTemplateFormatVersion": "2010-09-09",
    "Description": "This CloudFormation template creates a build for the apartments main ui.",
    "Resources": {
        "Angular4Build": {
            "Properties": {
                "Artifacts": {
                    "Location": "artifacts",
                    "Name": "Angular4Build",
                    "Packaging": "zip",
                    "Type": "S3"
                },
                "Environment": {
                    "ComputeType": "BUILD_GENERAL1_SMALL",
                    "EnvironmentVariables": [
                        {
                            "Name": "CHROME_BIN",
                            "Value": "/serverless-chrome/chrome/headless-chrome/headless_shell"
                        },
                        {
                            "Name": "BUCKET",
                            "Value": "websitename.com"
                        }
                    ],
                    "Image": "nplutt/ubuntu-docker-build",
                    "Type": "LINUX_CONTAINER"
                },
                "Name": "Angular4Build",
                "ServiceRole": {
                    "Ref": "Angular4BuildRole"
                },
                "Source": {
                    "Location": "https://github.com/nplutt/personal-website.git",
                    "Type": "GITHUB"
                },
                "TimeoutInMinutes": 10
            },
            "Type": "AWS::CodeBuild::Project"
        },
        "Angular4BuildPolicy": {
            "Properties": {
                "PolicyDocument": {
                    "Statement": [
                        {
                            "Action": [
                                "logs:CreateLogGroup",
                                "logs:CreateLogStream",
                                "logs:PutLogEvents"
                            ],
                            "Effect": "Allow",
                            "Resource": [
                                {
                                    "Fn::Join": [
                                        ":",
                                        [
                                            "arn:aws:logs",
                                            {
                                                "Ref": "AWS::Region"
                                            },
                                            {
                                                "Ref": "AWS::AccountId"
                                            },
                                            "log-group:/aws/codebuild/Angular4Build"
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        ":",
                                        [
                                            "arn:aws:logs",
                                            {
                                                "Ref": "AWS::Region"
                                            },
                                            {
                                                "Ref": "AWS::AccountId"
                                            },
                                            "log-group:/aws/codebuild/Angular4Build",
                                            "*"
                                        ]
                                    ]
                                }
                            ]
                        },
                        {
                            "Action": [
                                "s3:PutObject",
                                "s3:GetObject",
                                "s3:GetObjectVersion"
                            ],
                            "Effect": "Allow",
                            "Resource": [
                                "arn:aws:s3:::artifacts/*",
                                "arn:aws:s3:::websitename.com/*"
                            ]
                        }
                    ],
                    "Version": "2012-10-17"
                },
                "Roles": [
                    {
                        "Ref": "Angular4BuildRole"
                    }
                ]
            },
            "Type": "AWS::IAM::ManagedPolicy"
        },
        "Angular4BuildProfile": {
            "Properties": {
                "Path": "/service-role/",
                "Roles": [
                    {
                        "Ref": "Angular4BuildRole"
                    }
                ]
            },
            "Type": "AWS::IAM::InstanceProfile"
        },
        "Angular4BuildRole": {
            "Properties": {
                "AssumeRolePolicyDocument": {
                    "Statement": [
                        {
                            "Action": [
                                "sts:AssumeRole"
                            ],
                            "Effect": "Allow",
                            "Principal": {
                                "Service": [
                                    "codebuild.amazonaws.com"
                                ]
                            }
                        }
                    ]
                }
            },
            "Type": "AWS::IAM::Role"
        }
    }
}